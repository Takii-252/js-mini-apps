// ===================================
// タイマーアプリ - JavaScript
// ===================================


// ========================================
// 1. HTML要素を取得
// ========================================
const timeDisplay = document.getElementById("time-display");
// ↑ 画面の「20:00」を表示している部分

const startBtn = document.getElementById("start-btn");
const stopBtn = document.getElementById("stop-btn");
const resetBtn = document.getElementById("reset-btn");
// ↑ 各ボタンを取得


// ========================================
// 2. タイマー用の変数
// ========================================
let timeLeft = 20 * 60;  // 20分 = 1200秒
// ↑ 残り時間を「秒」で管理する
//   なぜ秒？→ 1秒ごとに1を引くだけでカウントダウンできる

let timerId = null;
// ↑ setIntervalのIDを保存する場所
//   後でストップボタンを押した時に「どのタイマーを止めるか」を特定するため


// ========================================
// 3. 時間を表示する関数
// ========================================
// 【この関数の役割】
//   timeLeft（例：1200秒）を「20:00」という形式に変換して画面に表示する
//
// 【なぜ必要？】
//   timeLeftは1200、1199、1198...と数字で管理しているが、
//   人間が見るには「20:00」「19:59」のような形式が必要
//
function updateDisplay() {
  const minutes = Math.floor(timeLeft / 60);
  // ↑ 秒を60で割って「分」を計算
  //   例: 1200 ÷ 60 = 20（分）
  //   Math.floor = 小数点以下を切り捨て
  
  const seconds = timeLeft % 60;
  // ↑ 60で割った「余り」が「秒」
  //   例: 1200 % 60 = 0（秒）
  //   例: 75 % 60 = 15（秒）→ 1分15秒
  
  const display = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
  // ↑ 「5」を「05」にするための処理
  //   padStart(2, '0') = 2桁になるまで先頭に0を追加
  //   例: "5".padStart(2, '0') → "05"
  //   例: "12".padStart(2, '0') → "12"（すでに2桁なのでそのまま）
  
  timeDisplay.textContent = display;
  // ↑ 【画面への影響】★ここで画面が更新される！★
  //   計算した「20:00」を画面に表示
}


// ========================================
// 4. スタートボタンを押したときの処理
// ========================================
startBtn.addEventListener("click", () => {
  // ↑ スタートボタンがクリックされたら...
  
  timerId = setInterval(() => {
    // ↑ setInterval = 「一定時間ごとに繰り返す」
    //   この中に書いた処理が、1000ミリ秒（1秒）ごとに実行される
    //   timerIdに保存 → 後でストップ時に使う
    
    timeLeft -= 1;
    // ↑ 残り時間を1秒減らす
    //   1200 → 1199 → 1198 → ...

    if (timeLeft <= 0) {
      // ↑ 残り時間が0以下になったら...
      
      clearInterval(timerId);
      // ↑ タイマーを停止
      
      const audio = new Audio("https://soundbible.com/grab.php?id=1252&type=mp3");
      audio.play();
      // ↑ 音を鳴らす
      //   new Audio("URL") = 音声ファイルを読み込む
      //   audio.play() = 再生
    }
    
    updateDisplay();
    // ↑ 画面を更新する
    
  }, 1000);
  // ↑ 1000ミリ秒 = 1秒ごとに繰り返す
});

// ========================================
// 5. ストップボタンを押したときの処理
// ========================================
stopBtn.addEventListener("click", () => {
  // ↑ ストップボタンがクリックされたら...
  
  clearInterval(timerId);
  // ↑ setIntervalで動いているタイマーを停止
  //   timerIdに保存しておいたIDを使って、どのタイマーを止めるか指定
  //   【画面への影響】カウントダウンが止まる（数字はそのまま）
});


// ========================================
// 6. リセットボタンを押したときの処理
// ========================================
resetBtn.addEventListener("click", () => {
  // ↑ リセットボタンがクリックされたら...
  
  clearInterval(timerId);
  // ↑ まずタイマーを停止（動いている場合）
  
  timeLeft = 20 * 60;
  // ↑ 残り時間を初期値（1200秒 = 20分）に戻す
  
  updateDisplay();
  // ↑ 【画面への影響】「20:00」に戻る
});